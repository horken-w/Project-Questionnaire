!function(e){"use strict";function t(e){return new RegExp("(^|\\s+)"+e+"(\\s+|$)")}function a(e,t){(i(e,t)?n:s)(e,t)}var i,s,n;"classList"in document.documentElement?(i=function(e,t){return e.classList.contains(t)},s=function(e,t){e.classList.add(t)},n=function(e,t){e.classList.remove(t)}):(i=function(e,a){return t(a).test(e.className)},s=function(e,t){i(e,t)||(e.className=e.className+" "+t)},n=function(e,a){e.className=e.className.replace(t(a)," ")});var o={hasClass:i,addClass:s,removeClass:n,toggleClass:a,has:i,add:s,remove:n,toggle:a};"function"==typeof define&&define.amd?define(o):"object"==typeof exports?module.exports=o:e.classie=o}(window),function(e,t,a,i){function s(t,i){this.w=e(a),this.el=e(t),this.options=e.extend({},l,i),this.init()}var n="ontouchstart"in a,o=function(){var e=a.createElement("div"),i=a.documentElement;if(!("pointerEvents"in e.style))return!1;e.style.pointerEvents="auto",e.style.pointerEvents="x",i.appendChild(e);var s=t.getComputedStyle&&"auto"===t.getComputedStyle(e,"").pointerEvents;return i.removeChild(e),!!s}(),l={listNodeName:"ol",itemNodeName:"li",rootClass:"dd",listClass:"dd-list",itemClass:"dd-item",dragClass:"dd-dragel",handleClass:"dd-handle",placeClass:"dd-placeholder",noDragClass:"dd-nodrag",emptyClass:"dd-empty",group:0,maxDepth:5,threshold:20};s.prototype={init:function(){var a=this;a.reset(),a.el.data("nestable-group",this.options.group),a.placeEl=e('<div class="'+a.options.placeClass+'"/>'),e.each(this.el.find(a.options.itemNodeName),function(t,i){a.setParent(e(i))});var i=function(t){var i=e(t.target);if(!i.hasClass(a.options.handleClass)){if(i.closest("."+a.options.noDragClass).length)return;i=i.closest("."+a.options.handleClass)}i.length&&!a.dragEl&&(a.isTouch=/^touch/.test(t.type),a.isTouch&&1!==t.touches.length||(t.preventDefault(),a.dragStart(t.touches?t.touches[0]:t)))},s=function(e){a.dragEl&&(e.preventDefault(),a.dragMove(e.touches?e.touches[0]:e))},o=function(e){a.dragEl&&(e.preventDefault(),a.dragStop(e.touches?e.touches[0]:e))};n&&(a.el[0].addEventListener("touchstart",i,!1),t.addEventListener("touchmove",s,!1),t.addEventListener("touchend",o,!1),t.addEventListener("touchcancel",o,!1)),a.el.on("mousedown",i),a.w.on("mousemove",s),a.w.on("mouseup",o)},serialize:function(){var t=this;return step=function(a,i){var s=[];return a.children(t.options.itemNodeName).each(function(){var a=e(this),n=e.extend({},a.data()),o=a.children(t.options.listNodeName);o.length&&(n.children=step(o,i+1)),s.push(n)}),s},step(t.el.find(t.options.listNodeName).first(),0)},serialise:function(){return this.serialize()},reset:function(){this.mouse={offsetX:0,offsetY:0,startX:0,startY:0,lastX:0,lastY:0,nowX:0,nowY:0,distX:0,distY:0,dirAx:0,dirX:0,dirY:0,lastDirX:0,lastDirY:0,distAxX:0,distAxY:0},this.isTouch=!1,this.moving=!1,this.dragEl=null,this.dragRootEl=null,this.dragDepth=0,this.hasNewRoot=!1,this.pointEl=null},setParent:function(t){t.children(this.options.listNodeName).length&&(t.prepend(e(this.options.expandBtnHTML)),t.prepend(e(this.options.collapseBtnHTML))),t.children('[data-action="expand"]').hide()},unsetParent:function(e){e.removeClass(this.options.collapsedClass),e.children("[data-action]").remove(),e.children(this.options.listNodeName).remove()},dragStart:function(t){var i=this.mouse,s=e(t.target),n=s.closest(this.options.itemNodeName);this.placeEl.css("height",n.height()),i.offsetX=void 0!==t.offsetX?t.offsetX:t.pageX-s.offset().left,i.offsetY=void 0!==t.offsetY?t.offsetY:t.pageY-s.offset().top,i.startX=i.lastX=t.pageX,i.startY=i.lastY=t.pageY,this.dragRootEl=this.el,this.dragEl=e(a.createElement(this.options.listNodeName)).addClass(this.options.listClass+" "+this.options.dragClass),this.dragEl.css("width",n.width()),n.after(this.placeEl),n[0].parentNode.removeChild(n[0]),n.appendTo(this.dragEl),e(a.body).append(this.dragEl),this.dragEl.css({left:t.pageX-i.offsetX,top:t.pageY-i.offsetY});var o,l,d=this.dragEl.find(this.options.itemNodeName);for(o=0;o<d.length;o++)(l=e(d[o]).parents(this.options.listNodeName).length)>this.dragDepth&&(this.dragDepth=l)},dragStop:function(e){var t=this.dragEl.children(this.options.itemNodeName).first();t[0].parentNode.removeChild(t[0]),this.placeEl.replaceWith(t),this.dragEl.remove(),this.el.trigger("change"),this.hasNewRoot&&this.dragRootEl.trigger("change"),this.reset()},dragMove:function(i){var s,n,l,d,r=this.options,c=this.mouse;this.dragEl.css({left:i.pageX-c.offsetX,top:i.pageY-c.offsetY}),c.lastX=c.nowX,c.lastY=c.nowY,c.nowX=i.pageX,c.nowY=i.pageY,c.distX=c.nowX-c.lastX,c.distY=c.nowY-c.lastY,c.lastDirX=c.dirX,c.lastDirY=c.dirY,c.dirX=0===c.distX?0:c.distX>0?1:-1,c.dirY=0===c.distY?0:c.distY>0?1:-1;var p=Math.abs(c.distX)>Math.abs(c.distY)?1:0;if(!c.moving)return c.dirAx=p,void(c.moving=!0);c.dirAx!==p?(c.distAxX=0,c.distAxY=0):(c.distAxX+=Math.abs(c.distX),0!==c.dirX&&c.dirX!==c.lastDirX&&(c.distAxX=0),c.distAxY+=Math.abs(c.distY),0!==c.dirY&&c.dirY!==c.lastDirY&&(c.distAxY=0)),c.dirAx=p,c.dirAx&&c.distAxX>=r.threshold&&(c.distAxX=0,l=this.placeEl.prev(r.itemNodeName),c.distX>0&&l.length&&!l.hasClass(r.collapsedClass)&&(s=l.find(r.listNodeName).last(),this.placeEl.parents(r.listNodeName).length+this.dragDepth<=r.maxDepth&&(s.length?(s=l.children(r.listNodeName).last(),s.append(this.placeEl)):(s=e("<"+r.listNodeName+"/>").addClass(r.listClass),s.append(this.placeEl),l.append(s),this.setParent(l)))),c.distX<0&&(d=this.placeEl.next(r.itemNodeName),d.length||(n=this.placeEl.parent(),this.placeEl.closest(r.itemNodeName).after(this.placeEl),n.children().length||this.unsetParent(n.parent()))));var h=!1;if(o||(this.dragEl[0].style.visibility="hidden"),this.pointEl=e(a.elementFromPoint(i.pageX-a.body.scrollLeft,i.pageY-(t.pageYOffset||a.documentElement.scrollTop))),o||(this.dragEl[0].style.visibility="visible"),this.pointEl.hasClass(r.handleClass)&&(this.pointEl=this.pointEl.parent(r.itemNodeName)),this.pointEl.hasClass(r.emptyClass))h=!0;else if(!this.pointEl.length||!this.pointEl.hasClass(r.itemClass))return;var u=this.pointEl.closest("."+r.rootClass),f=this.dragRootEl.data("nestable-id")!==u.data("nestable-id");if(!c.dirAx||f||h){if(f&&r.group!==u.data("nestable-group"))return;if(this.dragDepth-1+this.pointEl.parents(r.listNodeName).length>r.maxDepth)return;var m=i.pageY<this.pointEl.offset().top+this.pointEl.height()/2;n=this.placeEl.parent(),h?(s=e(a.createElement(r.listNodeName)).addClass(r.listClass),s.append(this.placeEl),this.pointEl.replaceWith(s)):m?this.pointEl.before(this.placeEl):this.pointEl.after(this.placeEl),n.children().length||this.unsetParent(n.parent()),this.dragRootEl.find(r.itemNodeName).length||this.dragRootEl.append('<div class="'+r.emptyClass+'"/>'),f&&(this.dragRootEl=u,this.hasNewRoot=this.el[0]!==this.dragRootEl[0])}}},e.fn.nestable=function(t){var a=this,i=this;return a.each(function(){var a=e(this).data("nestable");a?"string"==typeof t&&"function"==typeof a[t]&&(i=a[t]()):(e(this).data("nestable",new s(this,t)),e(this).data("nestable-id",(new Date).getTime()))}),i||a}}(window.jQuery||window.Zepto,window,document),function(e,t){"user strict";function a(e,t,a,i){e.addEventListener?e.addEventListener(t,function(){a(i)},!1):e.attachEvent&&e.attachEvent("on"+t,function(){a(i)})}function i(e,a){var i=t.createElement(e),s=function(e,t){return e+" "+t};return"string"==typeof a?i.className+=a:"object"==typeof a&&(i.className+=function(e,t,a){for(var i=t,s=0;s<a.length;s+=1)i=e(i,a[s]);return i}(s,"",a)),i}function s(a){this.w=$(t),this.v=e,this.el=$(a),this.init()}String.prototype.dot=function(){return"."+this},String.prototype.hashtag=function(){return"#"+this};var n={rootEl:"root",addGroupbtn:"group",exportDate:"submi",addSingleline:"sigle",addMultline:"txtar",addRadiobox:"radio",addCheckbox:"check",addmultRadio:"liker",itemNodeName:"li",listClass:"dd-list",itemClass:"dd-item",dragClass:"dd-dragel",handleClass:"dd-handle",contentClass:"dd3-content",deletebtn:"icon-del",createbtn:"icon-add"},o=$(i("div",[n.handleClass,"dd3-handle"])),l=$(i("div","dd3-content")),d=$(i("div",["answer","insidefiled"])),r=$(i("div","icon-btn")).append($(i("i",["material-icons","icon-small","icon-color"])).text("delete")),c={};s.prototype={init:function(){var e=this,t=$("[id]"),i=$("#sidebar");t.map(function(t,a){var i=a.id.slice(0,5);e.creatItemListener(i,a.id.hashtag())}),this.w.find($('input[name="quiztype"]')).on("click",function(e){"person"===this.value?($(".tablehide").removeClass("tablehide"),$(".denysele").removeClass("denysele")):$(".table").addClass("tablehide").delay(1e3).queue(function(){$(".boxsize").addClass("denysele").dequeue()})}),a(this.v,"scroll",e.sideBarAnimate,i),$("a").on("click",function(e){e.preventDefault()}),$("textarea").each(function(t,i){a(i,"keyup",e.inputboxAutoExpand,$(i))}),this.el.find(n.addGroupbtn.dot()).length>0&&(this.el.find(n.addGroupbtn.dot()).first().addClass("active"),this.el.find(n.addGroupbtn.dot()).map(function(t,i){a(i,"click",e.bildingSelected,this),a(i.childNodes[1].childNodes[3],"click",e.removeItem,this.parentElement),a(i.childNodes[1],"mouseenter",e.hideShowTrashbin,i.childNodes[1].childNodes[3]),a(i.childNodes[1],"mouseleave",e.hideShowTrashbin,i.childNodes[1].childNodes[3])}),this.el.find(n.itemClass.dot()).length>0&&(this.el.find(n.deletebtn.dot()).map(function(t,i){a(i,"click",e.removeItem,this.parentElement)}),this.el.find(n.createbtn.dot()).map(function(t,i){a(i,"click",e.subTextareaCreate,this.parentElement.parentElement)})))},creatItemListener:function(e,t){var i=this,s=$(t)[0];switch(e){case n.addGroupbtn:a(s,"click",i.groupCreat,i);break;case n.addSingleline:a(s,"click",i.singInputCreat,i);break;case n.addMultline:a(s,"click",i.multInputCreat,i);break;case n.addRadiobox:a(s,"click",i.radioBoxCreat,i);break;case n.addCheckbox:a(s,"click",i.checkBoxCreat,i);break;case n.addmultRadio:a(s,"click",i.multradioBoxCreat,i);break;case n.exportDate:a(s,"click",i.exportData,i)}},groupCreat:function(e){var t=this,i=$('<section class="group" data-group_seq=0 data-is_base_info=true/>'),s=void 0===t.wrap?$(n.listClass.dot()).first():t.wrap;$('<div class="hgtitle" />').append($('<h1 class="dd-handle" />').append($("<input/>",{class:"formtextInput titletextarea",row:1,value:"Group"}))).appendTo(i),i.find(".hgtitle").append(r.clone()),a(i.find(".hgtitle")[0],"mouseenter",e.hideShowTrashbin,i.find(".hgtitle")[0].childNodes[1]),a(i.find(".hgtitle")[0],"mouseleave",e.hideShowTrashbin,i.find(".hgtitle")[0].childNodes[1]),a(i[0],"click",e.bildingSelected,i[0]),i.append($('<div class="dd formfields"/>').append($('<ol class="'+n.listClass+'"/>'))),s.append($('<li class="'+n.itemClass+'"/>').append(i)),a(i.find(".icon-btn")[0],"click",e.removeItem,i[0].parentElement)},singInputCreat:function(e){var t=e.findParentExites(),s=$(i(n.itemNodeName,n.itemClass));t?(s.attr({"data-type":0,"data-attribute":0,"data-sequence":1}),s.append(r.clone()),a(s[0].children[0],"click",e.removeItem,s),s.append(o.clone().text("drag")),s.append(l.clone().append($('<textarea rows="2"/>').addClass("formtextInput singleline").val("Question(single-line)"))),s.append(d.clone().addClass("single").append($('<textarea rows="1" placeholder="Comments..."/>').addClass("formtextInput singleinput "))),s.find("textarea").each(function(t,i){a(i,"keyup",e.inputboxAutoExpand,$(i))}),s.appendTo($(t)),e.callingNestable(s.parent().parent())):alert("Please select / created group before you create items!!")},multInputCreat:function(e){var t=e.findParentExites(),s=$(i(n.itemNodeName,n.itemClass));t?(s.attr({"data-type":0,"data-attribute":1,"data-sequence":1}),s.append(r.clone()),a(s[0].children[0],"click",e.removeItem,s),s.append(o.clone().text("drag")),s.append(l.clone().append($('<textarea rows="2"/>').addClass("formtextInput singleline").val("Question(muti-line)"))),s.append(d.clone().append($('<textarea rows="4" placeholder="Comments..."/>').addClass("formtextInput singleinput "))),s.find("textarea").each(function(t,i){a(i,"keyup",e.inputboxAutoExpand,$(i))}),s.appendTo($(t)),e.callingNestable(s.parent().parent())):alert("Please select / created group before you create items!!")},radioBoxCreat:function(e){var t=e.findParentExites(),s=$(i(n.itemNodeName,n.itemClass));t?(s.attr({"data-type":0,"data-attribute":2,"data-sequence":1}),s.append(r.clone()),a(s[0].children[0],"click",e.removeItem,s),s.append(o.clone().text("drag")),s.append(l.clone().append($('<textarea rows="2"/>').addClass("formtextInput singleline").val("Question(radiobox)"))),s.append(d.clone()),e.subTextareaCreate(s.find(".answer")[0],e),s.appendTo($(t)),e.callingNestable(s.parent().parent())):alert("Please select / created group before you create items!!")},checkBoxCreat:function(e){var t=e.findParentExites(),s=$(i(n.itemNodeName,n.itemClass));t?(s.attr({"data-type":0,"data-attribute":3,"data-sequence":1}),s.append(r.clone()),a(s[0].children[0],"click",e.removeItem,s),s.append(o.clone().text("drag")),s.append(l.clone().append($('<textarea rows="4"/>').addClass("formtextInput singleline").val("Question(checkbox)"))),s.append(d.clone()),e.subTextareaCreate(s.find(".answer")[0],e),s.appendTo($(t)),e.callingNestable(s.parent().parent())):alert("Please select / created group before you create items!!")},multradioBoxCreat:function(e){var t=e.findParentExites(),s=["Agree","Like","Approval","Satisfacty"],c=$(i(n.itemNodeName,n.itemClass)),p=$('<select name="favorate" class="select answer-input" />');t?(c.attr({"data-type":0,"data-attribute":4,"data-sequence":1}),c.append(r.clone()),a(c[0].children[0],"click",e.removeItem,c),c.append(o.clone().text("drag")),c.append(l.clone().append($('<textarea rows="2"/>').addClass("formtextInput singleline").val("Question(likertScale)"))),c.append(d.clone()),s.map(function(e,t){p.append($('<option value="'+e+'">'+e+"</option>"))}),c.find(".answer").append($('<div class="answerwrap"/>')),$("<label/>",{class:"text answer-title",for:"answer",text:"Type: "}).appendTo(c.find(".answerwrap")),c.find(".answerwrap").append(p),c.appendTo($(t)),e.callingNestable(c.parent().parent())):alert("Please select / created group before you create items!!")},subTextareaCreate:function(e,t){var s=$('<div class="answerwrap"/>'),n=$(i("div",["icon-add","answer-add"])).append($(i("i",["material-icons","icon-small","icon-color"])).text("create")),o=$(i("div",["icon-del","answer-del"])).append($(i("i",["material-icons","icon-small","icon-color"])).text("delete"));s.append(o),s.append(n.clone()),s.find(".icon-add").on("click",function(){t.subTextareaCreate(e,t)}),s.append($("<label/>",{class:"text answer-title",for:"answer",text:"options: "})),s.append($("<input/>",{class:"select answer-input",type:"text",placeholder:"create your selection here... "})).appendTo(e),a(o[0],"click",t.removeItem,s)},bildingSelected:function(e){var t=e;$(n.addGroupbtn.dot()).removeClass("active"),$(t).addClass("active")},findParentExites:function(){return void 0!==t.getElementsByClassName("active")[0]&&(!!t.getElementsByClassName("active")[0].getElementsByClassName("dd-list")&&t.getElementsByClassName("active")[0].getElementsByClassName("dd-list"))},inputboxAutoExpand:function(e){var t=e[0].offsetHeight-e[0].clientHeight;e.css("height","auto").css("height",e[0].scrollHeight+t)},hideShowTrashbin:function(e){$(e).toggleClass("showout")},removeItem:function(e){var t=t="object"==typeof e[0]?e[0]:e;t.parentElement.children.length-1>0?e.remove():alert("Group can not be empty!")},callingNestable:function(e){e.nestable()},sideBarAnimate:function(a){t.getElementsByTagName("header")[0].offsetHeight;a.stop().animate({marginTop:$(e).scrollTop()+30+"px"},"slow")},serialize:function(){var e=["group_title","group_seq","is_base_info","questions"],a=["description","type","attribute","sequence","required","answers"],i=t.getElementsByTagName("form")[0],s=function(e,t,a){var i={};return a?(t.reduce(function(t,a){return void 0!==e.data(a)?i[a]=e.data(a):i[a]=[],i},{}),i.group_title=e.find("h1> input").val()):(t.reduce(function(t,a){return void 0!==e.data(a)?i[a]=e.data(a):i[a]=[],i},{}),i.group_title="個人資料"),i},n=function(e,t){for(var a=[],i=e.find(".dd-item"),s=0;s<i.length;s++){var n=i[s],o={};if(t.reduce(function(e,t){return void 0!==$(n).data(t)?o[t]=$(n).data(t):o[t]=[],o},{}),o.description=$(n).find("textarea:first")[0].value,o.required=!0,2===o.attribute||3===o.attribute||4===o.attribute)switch(o.attribute){case 2:case 3:var l=[];$(n.childNodes[3].children).each(function(e,t){l.push($(t).find("input").val())}),o.answers=l;break;case 4:o.typeOfScale=e.find("select option:selected").val()}a.push(o)}return a};c.title=i[0].value,c.description=i[1].value,c.footer=i[2].value,c.target=t.querySelector('input[name="quiztype"]:checked').value,c.groups=[],c.groups.push(s($(".pr-group"),e,!1)),c.groups[0].questions=function(e,t){var a=[];return t&&e.find("input:checked").length>0&&e.find("input:checked").each(function(e,t){var i={};i.description=t.parentElement.nextElementSibling.innerText,i.type=$(t).data("type"),i.attribute=$(t).data("attribute"),i.sequence=$(t).data("sequence"),i.required=!0,i.answers=["female","male","secret"],a.push(i)}),a}($(".pr-table"),a),$("section.group").map(function(t,i){c.groups.push(s($(i),e,!0)),c.groups[t+1].questions=n($(i),a)}),console.log(c)},exportData:function(e){return e.serialize()}},$(function(){new s("#root").callingNestable($(".formfields"))})}(window,document);